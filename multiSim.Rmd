---
title: "multiSim"
author: "Jonathan Cordell"
date: "17/02/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
classSize <- 30
noYears <- 6
subjectTeachers <- 0
maxTime <- 100
#Rate of infection + background
backgroundROI <- 3300/67000000 #https://www.ons.gov.uk/peoplepopulationandcommunity/populationandmigration/populationestimates
gammaParams <- c("spread.shape"=10,"spread.scale"=0.8,"recover.shape"=17,"recover.scale"=0.8)
testType <- "L"
probs <- list("L"=list("TP"=67/100,"TN"=99850/99900),"P"=list("TP"=95/100,"TN"=99.2/100), "N"=list("TP"=0,"TN"=1))
#https://www.bmj.com/content/373/bmj.n1411/rr
#https://www.ons.gov.uk/peoplepopulationandcommunity/healthandsocialcare/conditionsanddiseases/methodologies/covid19infectionsurveypilotmethodsandfurtherinformation
quarantineTime=10
catchRate <- 0.7
testDays <- c(5,7)
startingInfected <- 5
quarantineThreshold <- 30
teacherInfective <- 3
teacherInfectible <- 1.5
teacherTeacher <- 1.5
nonClass <- 0.7
weekend <- c(0.3,10)
maxIPeriod <- 20
save(classSize, noYears, subjectTeachers, maxTime, backgroundROI, gammaParams, testType, probs, quarantineTime, catchRate, testDays, startingInfected, quarantineThreshold, teacherInfective, teacherInfectible, teacherTeacher, nonClass, weekend, maxIPeriod, file="variables.Rdata")

source("sim.R")$value
x<-sim(classSize, noYears, subjectTeachers, maxTime, backgroundROI, gammaParams, testType, probs, quarantineTime, catchRate, testDays, startingInfected, quarantineThreshold, teacherInfective, teacherInfectible, teacherTeacher, nonClass, weekend, maxIPeriod)
# #results <- sapply(1:10,function(n) source("sim.R")$value)
# barplot(t(as.matrix(population)), col=c("cyan","yellow", "grey","red"), xlab="Days", ylab="Students", names.arg=(1:maxTime))
# legend("topright", colnames(population), fill=c("cyan","yellow", "grey","red"), bg="white")
# paste("Total time spent quarantining was",totalQ)
# paste("Average time students spent in isolation was",avgQ,"out of a possible",maxTime)
# paste("Final number of infected individuals was",finalI, "out of a possible",popSize)
# paste("Infeciton died out in",infectionEnd,"days")
# paste("Number of days with more than",quarantineThreshold,"quarantined was",overThreshold)
# paste("The average variance of students in class was",meanVar)
# paste("The maximum number of students absent in a single class at a given time was",classMax)
# print(runTime)


```